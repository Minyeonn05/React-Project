<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">


<!-- Mirrored from themesflat.co/html/ecomus/my-account.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 02 Sep 2024 12:27:45 GMT -->

<head>
    <meta charset="utf-8">
    <title>Ecomus - Ultimate HTML</title>

    <meta name="author" content="themesflat.com">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    <!-- font -->
    <link rel="stylesheet" href="fonts/fonts.css">
    <!-- Icons -->
    <link rel="stylesheet" href="fonts/font-icons.css">
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/swiper-bundle.min.css">
    <link rel="stylesheet" href="css/animate.css">
    <link rel="stylesheet" type="text/css" href="css/styles.css" />

    <!-- Favicon and Touch Icons  -->
    <link rel="shortcut icon" href="images/logo/favicon.png">
    <link rel="apple-touch-icon-precomposed" href="images/logo/favicon.png">

</head>

<body class="preload-wrapper">

    <div id="wrapper">
        <!-- header -->
        <header id="header" class="header-default header-absolute">
            <div class="px_15 lg-px_40">
                <div class="row wrapper-header align-items-center">
                    <div class="col-md-4 col-3 tf-lg-hidden">
                        <a href="#mobileMenu" data-bs-toggle="offcanvas" aria-controls="offcanvasLeft">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="16" viewBox="0 0 24 16"
                                fill="none">
                                <path
                                    d="M2.00056 2.28571H16.8577C17.1608 2.28571 17.4515 2.16531 17.6658 1.95098C17.8802 1.73665 18.0006 1.44596 18.0006 1.14286C18.0006 0.839753 17.8802 0.549063 17.6658 0.334735C17.4515 0.120408 17.1608 0 16.8577 0H2.00056C1.69745 0 1.40676 0.120408 1.19244 0.334735C0.978109 0.549063 0.857702 0.839753 0.857702 1.14286C0.857702 1.44596 0.978109 1.73665 1.19244 1.95098C1.40676 2.16531 1.69745 2.28571 2.00056 2.28571ZM0.857702 8C0.857702 7.6969 0.978109 7.40621 1.19244 7.19188C1.40676 6.97755 1.69745 6.85714 2.00056 6.85714H22.572C22.8751 6.85714 23.1658 6.97755 23.3801 7.19188C23.5944 7.40621 23.7148 7.6969 23.7148 8C23.7148 8.30311 23.5944 8.59379 23.3801 8.80812C23.1658 9.02245 22.8751 9.14286 22.572 9.14286H2.00056C1.69745 9.14286 1.40676 9.02245 1.19244 8.80812C0.978109 8.59379 0.857702 8.30311 0.857702 8ZM0.857702 14.8571C0.857702 14.554 0.978109 14.2633 1.19244 14.049C1.40676 13.8347 1.69745 13.7143 2.00056 13.7143H12.2863C12.5894 13.7143 12.8801 13.8347 13.0944 14.049C13.3087 14.2633 13.4291 14.554 13.4291 14.8571C13.4291 15.1602 13.3087 15.4509 13.0944 15.6653C12.8801 15.8796 12.5894 16 12.2863 16H2.00056C1.69745 16 1.40676 15.8796 1.19244 15.6653C0.978109 15.4509 0.857702 15.1602 0.857702 14.8571Z"
                                    fill="currentColor"></path>
                            </svg>
                        </a>
                    </div>
                    <div class="col-xl-3 col-md-4 col-6">
                        <a href="#" class="logo-header">
                            <img src="images/logo/logo.svg" alt="logo" class="logo">
                        </a>
                    </div>
                    <!-- <div class="col-xl-6 tf-md-hidden">
                        <nav class="box-navigation text-center">
                            <ul class="box-nav-ul d-flex align-items-center justify-content-center gap-30">
                                <li class="menu-item">
                                    <a href="index.html" class="item-link">Home</a>

                                </li>
                                <li class="menu-item">
                                    <a href="shop-default.html" class="item-link">Shop</a>

                                </li>
                                
                                <li class="menu-item position-relative">
                                    <a href="about-us.html" class="item-link">About us</a>

                                </li>

                            </ul>
                        </nav>
                    </div>
                    <div class="col-xl-3 col-md-4 col-3">
                        <ul class="nav-icon d-flex justify-content-end align-items-center gap-20">
                            
                            <li class="nav-account"><a href="#login" data-bs-toggle="modal" class="nav-icon-item"><i
                                        class="icon icon-account" onclick="checkloged()"></i></a></li>

                            <li class="nav-cart"><a href="#shoppingCart" data-bs-toggle="modal" class="nav-icon-item"><i
                                        class="icon icon-bag"></i><span class="count-box">0</span></a></li>
                        </ul>
                    </div> -->
                </div>
            </div>
        </header>
        <!-- /header -->

        <!-- page-title -->
        <div class="tf-page-title">
            <div class="container-full">
                <div class="heading text-center">Admin</div>
            </div>
        </div>
        <!-- /page-title -->

        <!-- page-cart -->
        <section class="flat-spacing-11">
            <div class="container">
                <div class="row">
                    <div class="col-lg-3">
                        <ul class="my-account-nav">
                            <li><a href="#" class="my-account-nav-item">Products</a></li>
                            <li><a href="adminOrder.html" class="my-account-nav-item">Order</a></li>

                            <li><a onclick="logout()" class="my-account-nav-item">Logout</a></li>
                        </ul>
                    </div>
                    <div class="col-lg-9">
                        <button class="btn btn-primary btn-sm" data-bs-toggle="modal"
                            data-bs-target="#addModal">Add</button>
                        <table class="table">
                            <thead class="thead-dark">
                                <tr>
                                    <th scope="col">Id</th>
                                    <th scope="col">Name</th>
                                    <th scope="col">Img</th>
                                    <th scope="col">Price</th>
                                    <th scope="col">Details</th>
                                    <th scope="col">Type</th>
                                    <th scope="col">Sizes</th>
                                    <th scope="col">Edit</th>
                                    <th scope="col">Remove</th>
                                </tr>
                            </thead>
                            <tbody id="products-list">
                                <tr>
                                    <th scope="row">1</th>
                                    <td>Mark</td>
                                    <td>Otto</td>
                                    <td>@mdo</td>
                                </tr>
                                <tr>
                                    <th scope="row">2</th>
                                    <td>Jacob</td>
                                    <td>Thornton</td>
                                    <td>@fat</td>
                                </tr>
                                <tr>
                                    <th scope="row">3</th>
                                    <td>Larry</td>
                                    <td>the Bird</td>
                                    <td>@twitter</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </section>
        <!-- page-cart -->

        <div class="modal fade" id="addModal" tabindex="-1" aria-labelledby="addModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="editModalLabel">Add Product</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body" id="editModalBody">
                        <form>
                            <div class="mb-3">
                                <label for="addProductId" class="form-label">Product ID</label>
                                <input type="text" class="form-control" id="addProductId">
                            </div>
                            <div class="mb-3">
                                <label for="addProductName" class="form-label">Product Name</label>
                                <input type="text" class="form-control" id="addProductName">
                            </div>
                            <div class="mb-3">
                                <label for="addProductImg" class="form-label">Image</label>
                                <input class="form-control form-control-sm" id="addProductImg1" type="file">
                                <input class="form-control form-control-sm" id="addProductImg2" type="file">
                                <input class="form-control form-control-sm" id="addProductImg3" type="file">
                                <input class="form-control form-control-sm" id="addProductImg4" type="file">
                                <input class="form-control form-control-sm" id="addProductImg5" type="file">
                            </div>
                            <div class="mb-3">
                                <label for="addProductPrice" class="form-label">Price</label>
                                <input type="number" class="form-control" id="addProductPrice">
                            </div>
                            <div class="mb-3">
                                <label for="addProductDetails" class="form-label">Details</label>
                                <textarea class="form-control" id="addProductDetails" rows="3"></textarea>
                            </div>
                            <div class="mb-3">
                                <label for="addProductType" class="form-label">Type</label>
                                <input type="text" class="form-control" id="addProductType">
                            </div>
                            <div class="mb-3">
                                <label for="addProductSize" class="form-label">Size</label>
                                <input type="text" class="form-control" id="addProductSize" placeholder="e.g., S, M, L">
                            </div>
                            <div class="form-check mb-3"> <input class="form-check-input" type="checkbox"
                                    id="addProductOnShop">
                                <label class="form-check-label" for="addProductOnShop">
                                    On Shop
                                </label>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="button" class="btn btn-primary" id="addProductBtn">Add</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal fade" id="sizeModal" tabindex="-1" aria-labelledby="sizeModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="sizeModalLabel">Product Sizes</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body" id="sizeModalBody">
                        <div class="col-lg-9">
                            <div class="mb-3">
                                <label for="newSizeInput" class="form-label">Size</label>
                                <input type="text" class="form-control" id="newSizeInput" placeholder="e.g., S, M, L">
                            </div>
                            <div class="form-check mb-3"> <input class="form-check-input" type="checkbox"
                                    id="newOnShopInput">
                                <label class="form-check-label" for="newOnShopInput">
                                    On Shop
                                </label>
                            </div>
                            <hr>
                            <table class="table">
                                <thead class="thead-dark">
                                    <tr>
                                        <th scope="col">id</th>
                                        <th scope="col">size</th>
                                        <th scope="col">OnShop</th>
                                        <th scope="col">Remove</th>
                                    </tr>
                                </thead>
                                <tbody id="sizes-list">
                                    <tr>
                                        <th scope="row">1</th>
                                        <td>Mark</td>
                                        <td>Otto</td>
                                    </tr>
                                    <tr>
                                        <th scope="row">2</th>
                                        <td>Jacob</td>
                                        <td>Thornton</td>
                                    </tr>
                                    <tr>
                                        <th scope="row">3</th>
                                        <td>Larry</td>
                                        <td>the Bird</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        <button type="button" class="btn btn-primary" id="addSizeBtn">Update</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal fade" id="editModal" tabindex="-1" aria-labelledby="editModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="editModalLabel">Edit Product</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body" id="editModalBody">
                        <form>
                            <div class="mb-3">
                                <label for="editProductId" class="form-label">Product ID</label>
                                <input type="text" class="form-control" id="editProductId" readonly>
                            </div>
                            <div class="mb-3">
                                <label for="editProductName" class="form-label">Product Name</label>
                                <input type="text" class="form-control" id="editProductName">
                            </div>
                            <div class="mb-3">
                                <label for="editProductImg" class="form-label">Image</label>
                                <input class="form-control form-control-sm" id="editProductImg1" type="file">
                                <input class="form-control form-control-sm" id="editProductImg2" type="file">
                                <input class="form-control form-control-sm" id="editProductImg3" type="file">
                                <input class="form-control form-control-sm" id="editProductImg4" type="file">
                                <input class="form-control form-control-sm" id="editProductImg5" type="file">
                            </div>
                            <div class="mb-3">
                                <label for="editProductPrice" class="form-label">Price</label>
                                <input type="number" class="form-control" id="editProductPrice">
                            </div>
                            <div class="mb-3">
                                <label for="editProductDetails" class="form-label">Details</label>
                                <textarea class="form-control" id="editProductDetails" rows="3"></textarea>
                            </div>
                            <div class="mb-3">
                                <label for="editProductType" class="form-label">Type</label>
                                <input type="text" class="form-control" id="editProductType">
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="button" class="btn btn-primary" id="editProductBtn">Save Changes</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal fade" id="removeModal" tabindex="-1" aria-labelledby="removeModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="removeModalLabel">Remove Product</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body" id="removeModalBody">
                        Are you sure you want to remove product <span id="removeProductId"></span>?
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="button" class="btn btn-danger" id="confirmRemoveBtn">Remove</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal fade" id="removeSize" tabindex="-1" aria-labelledby="removeSizeLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="removeSizeLabel">Remove Size in Product</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body" id="removeSizeBody">
                        Are you sure you want to remove size in product <span id="removeSizeId"></span> - <span
                            id="removeSizeName">?
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="button" class="btn btn-danger" id="confirmRemoveSizeBtn">Remove</button>
                    </div>
                </div>
            </div>
        </div>



        <!-- Javascript -->
        <script type="text/javascript" src="js/bootstrap.min.js"></script>
        <script type="text/javascript" src="js/jquery.min.js"></script>
        <script type="text/javascript" src="js/swiper-bundle.min.js"></script>
        <script type="text/javascript" src="js/carousel.js"></script>

        <script type="text/javascript" src="js/bootstrap-select.min.js"></script>
        <script type="text/javascript" src="js/lazysize.min.js"></script>
        <script type="text/javascript" src="js/count-down.js"></script>
        <script type="text/javascript" src="js/wow.min.js"></script>
        <script type="text/javascript" src="js/wow.min.js"></script>
        <script type="text/javascript" src="js/multiple-modal.js"></script>
        <script type="text/javascript" src="js/main.js"></script>
        <script type="text/javascript" src="js/main.js"></script>

        <script type="text/javascript" src="js/main.js"></script>

        <script>
            //AJAX function
            const ajax = async (config) => {
                const request = await fetch(config.url, {
                    method: config.method,
                    headers: {
                        'Accept': 'application/json',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(config.data)
                });
                const response = await request.json();
                console.log(reponse.status);
                return response;
            }
            document.addEventListener('DOMContentLoaded', function () {
                // ดึงข้อมูลผู้ใช้จาก localStorage
                const loggedInUser = localStorage.getItem('loggedInUser');

                if (loggedInUser) {
                    const user = JSON.parse(loggedInUser);
                    const greetingElement = document.getElementById('greeting-message');

                    if (greetingElement && user.fname) {
                        // เปลี่ยนข้อความทักทาย
                        greetingElement.textContent = `Hello ${user.fname}`;
                    }
                } else {
                    // ถ้าไม่มีข้อมูลใน localStorage (ยังไม่ได้ล็อกอิน) ให้กลับไปหน้าแรก
                    alert('Please log in to view your account.');
                    window.location.href = 'index.html';
                }

                // จัดการการ Logout
                const logoutButton = document.querySelector('.my-account-nav-item[href="index.html"]');
                if (logoutButton) {
                    logoutButton.addEventListener('click', function (event) {
                        event.preventDefault(); // หยุดการไปที่ login.html ทันที
                        localStorage.removeItem('loggedInUser'); // ลบข้อมูลผู้ใช้ออกจาก localStorage
                        alert('You have been logged out.');
                        window.location.href = 'index.html'; // กลับไปที่หน้าแรก
                    });
                }
            });
            // Function to handle user logout
            function logout() {
                alert('You have been logged out.');
                // Clear both localStorage and sessionStorage for user info
                localStorage.removeItem('loggedInUser');

                // Redirect to the login page
                window.location.href = 'index.html';
            }
            function loadProduct(url) {
                fetch(url)
                    .then(response => response.json())
                    .then(data => products(data));
            }
            function products(data) {
                const select = document.getElementById("products-list");
                select.innerHTML = '';
                //const datalist = JSON.parse(data);
                //var html_text ="";
                data.forEach(products => {
                    const product = document.createElement('tr');
                    product.innerHTML += `
                                    <th scope="row">${products.id}</th>
                                    <td>${products.name}</td> 
                                    `;
                    products.img.forEach(imgs => {
                        product.innerHTML += `<img src='./backend${imgs}' width="100" height="100"><br>`
                    })
                    product.innerHTML += `
                                    <td>${products.price}</td>
                                    <td>${products.detail}</td>
                                    <td>${products.type}</td>
                                    <td><button class="btn btn-info btn-sm size-btn" data-bs-toggle="modal" data-bs-target="#sizeModal" data-product-id="${products.id}">Size</button></td>
                                    <td><button class="btn btn-warning btn-sm edit-btn" data-bs-toggle="modal" data-bs-target="#editModal" data-products='${JSON.stringify(products)}'>Edit</button></td>
                                    <td><button class="btn btn-danger btn-sm remove-btn" data-bs-toggle="modal" data-bs-target="#removeModal" data-product-id="${products.id}">Remove</button></td>
                                `;

                    select.appendChild(product);

                });
                //select = html_text;

                // --- Attach event listeners after all product rows are added ---
                const sizeButtons = document.querySelectorAll('.size-btn');
                sizeButtons.forEach(button => {
                    button.addEventListener('click', function () {
                        const productId = parseInt(this.dataset.productId); // Get product ID from data-attribute
                        sizeslist(productId, data); // Pass the loaded 'data' array
                    });
                });

                // --- Attach event listeners after all product rows are added ---
                const editButtons = document.querySelectorAll('.edit-btn');
                editButtons.forEach(button => {
                    button.addEventListener('click', function () {
                        const productData = JSON.parse(this.dataset.products); // แปลงกลับเป็น object
                        document.getElementById('editProductId').value = productData.id;
                        document.getElementById('editProductName').value = productData.name;
                        document.getElementById('editProductPrice').value = productData.price;
                        document.getElementById('editProductDetails').value = productData.detail;
                        document.getElementById('editProductType').value = productData.type;

                        document.getElementById('editProductBtn').dataset.products = productData;
                    });
                });
                document.getElementById('editProductBtn').addEventListener('click', async function () {
                    const productIdEdit = document.getElementById('editProductId').value;
                    const productNameEdit = document.getElementById('editProductName').value;
                    const productPriceEdit = document.getElementById('editProductPrice').value;
                    const productDetailsEdit = document.getElementById('editProductDetails').value;
                    const productTypeEdit = document.getElementById('editProductType').value;

                    // Basic validation
                    if (!productIdEdit) {
                        alert('Please fill in the id field.');
                        return;
                    }

                    // สร้าง FormData แทน object ปกติ
                    const formData = new FormData();
                    formData.append('id', productIdEdit);
                    formData.append('name', productNameEdit);
                    formData.append('price', productPriceEdit);
                    formData.append('detail', productDetailsEdit);
                    formData.append('type', productTypeEdit);

                    // แนบรูปภาพ (สูงสุด 5 รูป)
                    const fileInputs = [
                        'editProductImg1',
                        'editProductImg2',
                        'editProductImg3',
                        'editProductImg4',
                        'editProductImg5'
                    ];
                    for (let id of fileInputs) {
                        const input = document.getElementById(id);
                        if (input.files.length > 0) {
                            formData.append('img', input.files[0]); // หรือใช้ชื่อ 'img[]' ถ้า backend ต้องการแบบ array
                        }
                    }

                    try {
                        const response = await fetch('http://localhost:5000/api/products/edit', {
                            method: 'POST',
                            body: formData
                        });

                        if (!response.ok) {
                            throw new Error('Failed to edit product');
                        }

                        await loadProduct('http://localhost:5000/api/products');
                        alert('Product edited successfully!');
                    } catch (err) {
                        console.error(err);
                        alert('Error editing product');
                    }

                    //loadProduct('http://localhost:5000/api/products');
                    //alert('Product add successfully!');
                })

                const removeButtons = document.querySelectorAll('.remove-btn');
                removeButtons.forEach(button => {
                    button.addEventListener('click', function () {
                        const productId = parseInt(this.dataset.productId);
                        document.getElementById('removeProductId').textContent = productId;

                        document.getElementById('confirmRemoveBtn').dataset.productId = productId;
                    });
                });

                // Event listener for confirming removal inside the modal
                document.getElementById('confirmRemoveBtn').addEventListener('click', async function () {
                    const productIdToRemove = parseInt(this.dataset.productId);
                    if (isNaN(productIdToRemove)) {
                        console.error("Product ID is not valid for removal.");
                        return;
                    }

                    let data = {
                        id: productIdToRemove
                    };
                    //console.log("Attempting to remove product with ID:", data.id);

                    let config = {
                        url: 'http://localhost:5000/api/products/remove',
                        method: 'POST', // Assuming your API uses POST for removal
                        data: data
                    };

                    const response = await ajax(config);
                    loadProduct('http://localhost:5000/api/products');
                    alert('Product removed successfully!');
                });
            }

            function sizeslist(id, allProductsData) {
                const select = document.getElementById("sizes-list");
                select.innerHTML = ''; // Clear previous content

                // Find the product with the matching ID
                // Ensure allProductsData is an array of product objects
                const product = allProductsData.find(item => item.id == id);

                if (product && product.sizes) {
                    product.sizes.forEach(sizeItem => {
                        const sizeRow = document.createElement('tr');
                        sizeRow.innerHTML = `
                <th scope="row">${product.id}</th>
                <td>${sizeItem.size}</td>`;
                        if (sizeItem.onShop == true) {
                            sizeRow.innerHTML += `<td>✅</td>`
                        } else {
                            sizeRow.innerHTML += `<td>❌</td>`
                        }
                        sizeRow.innerHTML += `<td><button class="btn btn-danger btn-sm remove-btn" data-bs-toggle="modal" data-bs-target="#removeSize" data-product-id="${product.id}" data-size-name="${sizeItem.size}">Remove</button></td>`

                        select.appendChild(sizeRow);
                    });

                    const removeButtons = document.querySelectorAll('.remove-btn');
                    removeButtons.forEach(button => {
                        button.addEventListener('click', function () {
                            const productId = parseInt(this.dataset.productId);
                            const sizeName = this.dataset.sizeName
                            document.getElementById('removeSizeId').textContent = productId;
                            document.getElementById('removeSizeName').textContent = sizeName;

                            document.getElementById('confirmRemoveSizeBtn').dataset.productId = productId;
                            document.getElementById('confirmRemoveSizeBtn').dataset.sizeName = sizeName;
                        });
                    });

                    // Event listener for confirming removal inside the modal
                    document.getElementById('confirmRemoveSizeBtn').addEventListener('click', async function () {
                        const productIdToRemove = parseInt(this.dataset.productId);
                        const sizeNameToRemove = this.dataset.sizeName;
                        console.log(sizeNameToRemove);
                        if (isNaN(productIdToRemove)) {
                            console.error("Product ID is not valid for removal.");
                            return;
                        }

                        let data = {
                            id: productIdToRemove,
                            size: sizeNameToRemove
                        };
                        //console.log("Attempting to remove product with ID:", data.id);

                        let config = {
                            url: 'http://localhost:5000/api/products/sizeRemove',
                            method: 'POST', // Assuming your API uses POST for removal
                            data: data
                        };

                        const response = await ajax(config);
                        loadProduct('http://localhost:5000/api/products');
                        alert('Size in Product removed successfully!');
                    });

                    // Event listener for confirming removal inside the modal
                    document.getElementById('addSizeBtn').addEventListener('click', async function () {
                        //const addSizeBtn = document.getElementById('addSizeBtn');
                        const newSizeInput = document.getElementById('newSizeInput');
                        const newOnShopInput = document.getElementById('newOnShopInput'); // This is now the checkbox element

                        //addSizeBtn.addEventListener('click', function () {
                        const sizeValue = newSizeInput.value;
                        const onShopValue = newOnShopInput.checked; // Get the boolean 'checked' state

                        // Basic validation
                        if (!sizeValue) { // Only sizeValue needs validation, onShopValue will always be true/false
                            alert('Please fill in the Size field.');
                            return;
                        }

                        // Prepare the data to be sent
                        const data = {
                            id: product.id,
                            size: sizeValue,
                            onShop: onShopValue // Send the boolean directly
                        };
                        //console.log("Attempting to remove product with ID:", data.id);

                        let config = {
                            url: 'http://localhost:5000/api/products/sizeAdd',
                            method: 'POST', // Assuming your API uses POST for removal
                            data: data
                        };

                        const response = await ajax(config);
                        loadProduct('http://localhost:5000/api/products');
                        alert('Size in Product removed successfully!');

                        //});
                    });
                } else {
                    // Handle case where product or sizes array is not found
                    const noSizesRow = document.createElement('tr');
                    noSizesRow.innerHTML = `<td colspan="3">No size information available for this product.</td>`;
                    select.appendChild(noSizesRow);
                }
            }

            document.getElementById('addProductBtn').addEventListener('click', async function () {
                const productIdAdd = document.getElementById('addProductId').value;
                const productNameAdd = document.getElementById('addProductName').value;
                const productPriceAdd = document.getElementById('addProductPrice').value;
                const productDetailsAdd = document.getElementById('addProductDetails').value;
                const productTypeAdd = document.getElementById('addProductType').value;
                const productSizeAdd = document.getElementById('addProductSize').value;
                const productOnShopAdd = document.getElementById('addProductOnShop').checked;

                // Basic validation
                if (!productIdAdd) {
                    alert('Please fill in the id field.');
                    return;
                }
                // Basic validation
                if (!productSizeAdd) {
                    alert('Please fill in the size field.');
                    return;
                }

                // Prepare the data to be sent
                // const data = {
                //     id: productIdAdd,
                //     name: productNameAdd,
                //     img: productImgAdd,
                //     price: productPriceAdd,
                //     detail: productDetailsAdd,
                //     type: productTypeAdd,
                //     size: productSizeAdd,
                //     onShop: productOnShopAdd // Send the boolean directly
                // };
                //console.log("Attempting to remove product with ID:", data.id);

                // Append image files
                // const fileInputs = [
                //     'addProductImg1',
                //     'addProductImg2',
                //     'addProductImg3',
                //     'addProductImg4',
                //     'addProductImg5'
                // ];
                // const formData = new FormData();
                // for (let id of fileInputs) {
                //     const input = document.getElementById(id);
                //     if (input.files.length > 0) {
                //         formData.append('img', input.files[0]); // Assuming API accepts array of images under 'images'
                //     }
                // }

                // imgs = [
                //     document.getElementById('addProductImg1').files[0],
                //     document.getElementById('addProductImg2').files[0],
                //     document.getElementById('addProductImg3').files[0],
                //     document.getElementById('addProductImg4').files[0],
                //     document.getElementById('addProductImg5').files[0],
                // ];
                //console.log(imgs);

                // let data = {
                //     id: productIdAdd,
                //     name: productNameAdd,
                //     formData,
                //     price: productPriceAdd,
                //     detail: productDetailsAdd,
                //     type: productTypeAdd,
                //     size: productSizeAdd,
                //     onShop: productOnShopAdd
                // };

                // สร้าง FormData แทน object ปกติ
                const formData = new FormData();
                formData.append('id', productIdAdd);
                formData.append('name', productNameAdd);
                formData.append('price', productPriceAdd);
                formData.append('detail', productDetailsAdd);
                formData.append('type', productTypeAdd);
                formData.append('size', productSizeAdd);
                formData.append('onShop', productOnShopAdd);

                // แนบรูปภาพ (สูงสุด 5 รูป)
                const fileInputs = [
                    'addProductImg1',
                    'addProductImg2',
                    'addProductImg3',
                    'addProductImg4',
                    'addProductImg5'
                ];
                for (let id of fileInputs) {
                    const input = document.getElementById(id);
                    if (input.files.length > 0) {
                        formData.append('img', input.files[0]); // หรือใช้ชื่อ 'img[]' ถ้า backend ต้องการแบบ array
                    }
                }


                // let config = {
                //     url: 'http://localhost:5000/api/products/add',
                //     method: 'POST', // Assuming your API uses POST for removal
                //     data: formData
                // };

                // const response = await ajax(config);

                try {
                    const response = await fetch('http://localhost:5000/api/products/add', {
                        method: 'POST',
                        body: formData
                    });

                    if (!response.ok) {
                        throw new Error('Failed to add product');
                    }

                    await loadProduct('http://localhost:5000/api/products');
                    alert('Product added successfully!');
                } catch (err) {
                    console.error(err);
                    alert('Error adding product');
                }

                //loadProduct('http://localhost:5000/api/products');
                //alert('Product add successfully!');
            })


            // --- ส่วนของการตั้งเวลา Polling ---
            // กำหนดช่วงเวลา (เป็นมิลลิวินาที) เช่น 5000ms = 5 วินาที
            const POLLING_INTERVAL = 5000; // 5 วินาที

            window.onload = function () {
                //loadProduct('http://localhost:5000/api/products');
                loadProduct('http://localhost:5000/api/products');

                // ตั้งค่าให้ loadProduct ถูกเรียกซ้ำทุกๆ POLLING_INTERVAL
                setInterval(loadProduct, POLLING_INTERVAL);
            }
        </script>
</body>
</body>


<!-- Mirrored from themesflat.co/html/ecomus/my-account.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 02 Sep 2024 12:27:48 GMT -->

</html>